{
  "version": 3,
  "sources": ["../server/index.ts"],
  "sourcesContent": ["import { styleText } from 'node:util'\nimport { helmet } from '@nichtsam/helmet/node-http'\nimport { createRequestHandler } from '@react-router/express'\nimport { logger, sentryLogger } from '@repo/observability'\nimport * as Sentry from '@sentry/react-router'\nimport { ip as ipAddress } from 'address'\nimport closeWithGrace from 'close-with-grace'\nimport compression from 'compression'\nimport express from 'express'\nimport rateLimit from 'express-rate-limit'\nimport getPort, { portNumbers } from 'get-port'\nimport morgan from 'morgan'\nimport { type ServerBuild } from 'react-router'\n\nconst MODE = process.env.NODE_ENV ?? 'development'\nconst IS_PROD = MODE === 'production'\nconst IS_DEV = MODE === 'development'\nconst ALLOW_INDEXING = process.env.ALLOW_INDEXING !== 'false'\nconst SENTRY_ENABLED = IS_PROD && process.env.SENTRY_DSN\n\nif (SENTRY_ENABLED) {\n\tvoid import('./utils/monitoring.js').then(({ init }) => init())\n}\n\nconst viteDevServer = IS_PROD\n\t? undefined\n\t: await import('vite').then((vite) =>\n\t\t\tvite.createServer({\n\t\t\t\tserver: {\n\t\t\t\t\tmiddlewareMode: true,\n\t\t\t\t},\n\t\t\t\t// We tell Vite we are running a custom app instead of\n\t\t\t\t// the SPA default so it doesn't run HTML middleware\n\t\t\t\tappType: 'custom',\n\t\t\t}),\n\t\t)\n\nconst app = express()\n\n// \u2705 EARLY CORS + LOGGING MIDDLEWARE\napp.use((req, res, next) => {\n\tconst origin = req.get('Origin')\n\tconst allowedOrigins = [\n\t\t'https://dashboard-v0.novu.co',\n\t\t// Allow localhost origins for development (mobile app)\n\t\t...(IS_DEV\n\t\t\t? [\n\t\t\t\t\t'http://localhost:8081',\n\t\t\t\t\t'http://localhost:8082',\n\t\t\t\t\t'http://localhost:19006', // Default Expo web port\n\t\t\t\t]\n\t\t\t: []),\n\t]\n\n\tif (allowedOrigins.includes(origin || '')) {\n\t\tres.header('Access-Control-Allow-Origin', origin)\n\t\tres.header(\n\t\t\t'Access-Control-Allow-Methods',\n\t\t\t'GET, POST, PUT, DELETE, OPTIONS',\n\t\t)\n\t\tres.header(\n\t\t\t'Access-Control-Allow-Headers',\n\t\t\t'Origin, Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers, Authorization, bypass-tunnel-reminder, baggage, sentry-trace, bypass-tunnel-reminder',\n\t\t)\n\t\tres.header('Access-Control-Allow-Credentials', 'true')\n\t}\n\n\tif (req.method === 'OPTIONS') {\n\t\treturn res.sendStatus(204)\n\t}\n\n\tnext()\n})\n\nconst getHost = (req: { get: (key: string) => string | undefined }) =>\n\treq.get('X-Forwarded-Host') ?? req.get('host') ?? ''\n\n// fly is our proxy\napp.set('trust proxy', true)\n\n// ensure HTTPS only (X-Forwarded-Proto comes from Fly)\napp.use((req, res, next) => {\n\tif (req.method !== 'GET') return next()\n\tconst proto = req.get('X-Forwarded-Proto')\n\tconst host = getHost(req)\n\tif (proto === 'http') {\n\t\tres.set('X-Forwarded-Proto', 'https')\n\t\tres.redirect(`https://${host}${req.originalUrl}`)\n\t\treturn\n\t}\n\tnext()\n})\n\n// no ending slashes for SEO reasons\n// https://github.com/epicweb-dev/epic-stack/discussions/108\napp.get('*', (req, res, next) => {\n\tif (req.path.endsWith('/') && req.path.length > 1) {\n\t\tconst query = req.url.slice(req.path.length)\n\t\tconst safepath = req.path.slice(0, -1).replace(/\\/+/g, '/')\n\t\tres.redirect(302, safepath + query)\n\t} else {\n\t\tnext()\n\t}\n})\n\napp.use(compression())\n\n// http://expressjs.com/en/advanced/best-practice-security.html#at-a-minimum-disable-x-powered-by-header\napp.disable('x-powered-by')\n\n// Then continue with general middleware handling\napp.use((req, res, next) => {\n\t// Apply Helmet for non-Novu routes\n\tif (!req.url.includes('/novu')) {\n\t\thelmet(res, { general: { referrerPolicy: false } })\n\t}\n\tnext()\n})\n\nif (viteDevServer) {\n\tapp.use(viteDevServer.middlewares)\n} else {\n\t// Remix fingerprints its assets so we can cache forever.\n\tapp.use(\n\t\t'/assets',\n\t\texpress.static('build/client/assets', { immutable: true, maxAge: '1y' }),\n\t)\n\n\t// Everything else (like favicon.ico) is cached for an hour. You may want to be\n\t// more aggressive with this caching.\n\tapp.use(express.static('build/client', { maxAge: '1h' }))\n}\n\napp.get(['/img/*', '/favicons/*'], (_req, res) => {\n\t// if we made it past the express.static for these, then we're missing something.\n\t// So we'll just send a 404 and won't bother calling other middleware.\n\treturn res.status(404).send('Not found')\n})\n\nmorgan.token('url', (req) => {\n\ttry {\n\t\treturn decodeURIComponent(req.url ?? '')\n\t} catch {\n\t\treturn req.url ?? ''\n\t}\n})\napp.use(\n\tmorgan('tiny', {\n\t\tskip: (req, res) =>\n\t\t\tres.statusCode === 200 &&\n\t\t\t(req.url?.startsWith('/resources/images') ||\n\t\t\t\treq.url?.startsWith('/resources/healthcheck')),\n\t}),\n)\n\n// IP tracking and blacklist middleware\napp.use(async (req, res, next) => {\n\ttry {\n\t\t// Check if IP is blacklisted first\n\t\tconst ipTracking = await import('@repo/common/ip-tracking')\n\t\tconst ip = req.get('fly-client-ip') || req.ip || '127.0.0.1'\n\n\t\tconst isBlacklisted = await ipTracking.isIpBlacklisted(ip)\n\t\tif (isBlacklisted) {\n\t\t\treturn res.status(403).json({\n\t\t\t\terror: 'Access denied',\n\t\t\t\tmessage: 'Your IP address has been blocked due to suspicious activity.',\n\t\t\t\tcode: 'IP_BLACKLISTED',\n\t\t\t})\n\t\t}\n\t} catch (error) {\n\t\t// If there's an error checking blacklist, log it but don't block the request\n\t\tlogger.error({ err: error }, 'Error checking IP blacklist')\n\t}\n\n\t// Track the request after the response is finished\n\tres.on('finish', () => {\n\t\t// Track the request asynchronously\n\t\tsetImmediate(async () => {\n\t\t\ttry {\n\t\t\t\tconst ipTracking = await import('@repo/common/ip-tracking')\n\t\t\t\tconst ip = req.get('fly-client-ip') || req.ip || '127.0.0.1'\n\t\t\t\tawait ipTracking.trackIpRequest({\n\t\t\t\t\tip,\n\t\t\t\t\tmethod: req.method,\n\t\t\t\t\tpath: req.path,\n\t\t\t\t\tuserAgent: req.get('user-agent'),\n\t\t\t\t\treferer: req.get('referer'),\n\t\t\t\t\tstatusCode: res.statusCode,\n\t\t\t\t})\n\t\t\t} catch (error) {\n\t\t\t\t// Silently fail to not break the app\n\t\t\t\tlogger.error({ err: error }, 'IP tracking error')\n\t\t\t}\n\t\t})\n\t})\n\n\tnext()\n})\n\n// Periodic cleanup of in-memory request counts (every 5 minutes)\nsetInterval(\n\tasync () => {\n\t\ttry {\n\t\t\tconst ipTracking = await import('@repo/common/ip-tracking')\n\t\t\tipTracking.cleanupRequestCounts()\n\t\t} catch (error) {\n\t\t\tlogger.error({ err: error }, 'Error cleaning up request counts')\n\t\t}\n\t},\n\t5 * 60 * 1000,\n)\n\n// When running tests or running in development, we want to effectively disable\n// rate limiting because playwright tests are very fast and we don't want to\n// have to wait for the rate limit to reset between tests.\nconst maxMultiple =\n\t!IS_PROD || process.env.PLAYWRIGHT_TEST_BASE_URL ? 10_000 : 1\nconst rateLimitDefault = {\n\twindowMs: 60 * 1000,\n\tlimit: 1000 * maxMultiple,\n\tstandardHeaders: true,\n\tlegacyHeaders: false,\n\tvalidate: { trustProxy: false },\n\t// Malicious users can spoof their IP address which means we should not default\n\t// to trusting req.ip when hosted on Fly.io. However, users cannot spoof Fly-Client-Ip.\n\t// When sitting behind a CDN such as cloudflare, replace fly-client-ip with the CDN\n\t// specific header such as cf-connecting-ip\n\tkeyGenerator: (req: express.Request) => {\n\t\treturn req.get('fly-client-ip') ?? `${req.ip}`\n\t},\n}\n\nconst strongestRateLimit = rateLimit({\n\t...rateLimitDefault,\n\twindowMs: 60 * 1000,\n\tlimit: 10 * maxMultiple,\n})\n\nconst strongRateLimit = rateLimit({\n\t...rateLimitDefault,\n\twindowMs: 60 * 1000,\n\tlimit: 100 * maxMultiple,\n})\n\nconst generalRateLimit = rateLimit(rateLimitDefault)\napp.use((req, res, next) => {\n\tconst strongPaths = [\n\t\t'/login',\n\t\t'/signup',\n\t\t'/verify',\n\t\t'/admin',\n\t\t'/onboarding',\n\t\t'/reset-password',\n\t\t'/settings/profile',\n\t\t'/resources/login',\n\t\t'/resources/verify',\n\t]\n\tif (req.method !== 'GET' && req.method !== 'HEAD') {\n\t\tif (strongPaths.some((p) => req.path.includes(p))) {\n\t\t\treturn strongestRateLimit(req, res, next)\n\t\t}\n\t\treturn strongRateLimit(req, res, next)\n\t}\n\n\t// the verify route is a special case because it's a GET route that\n\t// can have a token in the query string\n\tif (req.path.includes('/verify')) {\n\t\treturn strongestRateLimit(req, res, next)\n\t}\n\n\treturn generalRateLimit(req, res, next)\n})\n\nasync function getBuild() {\n\ttry {\n\t\tconst build = viteDevServer\n\t\t\t? await viteDevServer.ssrLoadModule('virtual:react-router/server-build')\n\t\t\t: // @ts-expect-error - the file might not exist yet but it will\n\t\t\t\tawait import('../build/server/index.js')\n\n\t\treturn { build: build as unknown as ServerBuild, error: null }\n\t} catch (error) {\n\t\t// Catch error and return null to make express happy and avoid an unrecoverable crash\n\t\tsentryLogger.error({ err: error }, 'Error creating build')\n\t\treturn { error: error, build: null as unknown as ServerBuild }\n\t}\n}\n\nif (!ALLOW_INDEXING) {\n\tapp.use((_, res, next) => {\n\t\tres.set('X-Robots-Tag', 'noindex, nofollow')\n\t\tnext()\n\t})\n}\n\napp.all('/api/novu*', (req, res, next) => {\n\t// Capture original writeHead\n\t// CORS headers are already handled by the middleware at lines 42-74\n\t// Removed hardcoded CORS override to prevent security bypass\n\n\treturn createRequestHandler({\n\t\tgetLoadContext: () => ({ serverBuild: getBuild() }),\n\t\tmode: MODE,\n\t\tbuild: async () => {\n\t\t\tconst { error, build } = await getBuild()\n\t\t\tif (error) throw error\n\t\t\treturn build\n\t\t},\n\t})(req, res, next)\n})\n\napp.all(\n\t'*',\n\tcreateRequestHandler({\n\t\tgetLoadContext: () => ({ serverBuild: getBuild() }),\n\t\tmode: MODE,\n\t\tbuild: async () => {\n\t\t\tconst { error, build } = await getBuild()\n\t\t\t// gracefully \"catch\" the error\n\t\t\tif (error) {\n\t\t\t\tthrow error\n\t\t\t}\n\t\t\treturn build\n\t\t},\n\t}),\n)\n\nconst desiredPort = Number(process.env.PORT || 3001)\nconst portToUse = await getPort({\n\tport: portNumbers(desiredPort, desiredPort + 100),\n})\nconst portAvailable = desiredPort === portToUse\nif (!portAvailable && !IS_DEV) {\n\tlogger.warn({ desiredPort, portToUse }, 'Port not available')\n\tprocess.exit(1)\n}\n\nconst server = app.listen(portToUse, () => {\n\tif (!portAvailable) {\n\t\tlogger.warn(\n\t\t\t{ desiredPort, portToUse },\n\t\t\t`Port ${desiredPort} is not available, using ${portToUse} instead`,\n\t\t)\n\t\tconsole.warn(\n\t\t\tstyleText(\n\t\t\t\t'yellow',\n\t\t\t\t`\u26A0\uFE0F  Port ${desiredPort} is not available, using ${portToUse} instead.`,\n\t\t\t),\n\t\t)\n\t}\n\n\tconst localUrl = `http://localhost:${portToUse}`\n\tlet lanUrl: string | null = null\n\tconst localIp = ipAddress() ?? 'Unknown'\n\t// Check if the address is a private ip\n\t// https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces\n\t// https://github.com/facebook/create-react-app/blob/d960b9e38c062584ff6cfb1a70e1512509a966e7/packages/react-dev-utils/WebpackDevServerUtils.js#LL48C9-L54C10\n\tif (/^10[.]|^172[.](1[6-9]|2[0-9]|3[0-1])[.]|^192[.]168[.]/.test(localIp)) {\n\t\tlanUrl = `http://${localIp}:${portToUse}`\n\t}\n\n\tlogger.info(\n\t\t{ port: portToUse, localUrl, lanUrl, mode: MODE },\n\t\t'Server started successfully',\n\t)\n\n\tconsole.log(`\uD83D\uDE80  We have liftoff!`)\n\tconsole.log(\n\t\t`\n${styleText('bold', 'Local:')}            ${styleText('cyan', localUrl)}\n${lanUrl ? `${styleText('bold', 'On Your Network:')}  ${styleText('cyan', lanUrl)}` : ''}\n${styleText('bold', 'Press Ctrl+C to stop')}\n\t\t`.trim(),\n\t)\n})\n\ncloseWithGrace(async ({ err }) => {\n\tawait new Promise((resolve, reject) => {\n\t\tserver.close((e) => (e ? reject(e) : resolve('ok')))\n\t})\n\tif (err) {\n\t\t// Log to console first for immediate visibility\n\t\tconsole.error(styleText('red', String(err)))\n\t\tconsole.error(styleText('red', String(err.stack)))\n\n\t\t// Capture to Sentry with explicit call to ensure it completes before flush\n\t\tif (SENTRY_ENABLED) {\n\t\t\tSentry.captureException(err, {\n\t\t\t\tlevel: 'fatal',\n\t\t\t\textra: { context: 'server_shutdown' },\n\t\t\t})\n\t\t\tawait Sentry.flush(500)\n\t\t}\n\n\t\t// Also log via pino for structured logging\n\t\tsentryLogger.fatal({ err }, 'Server shutting down with error')\n\t} else {\n\t\tlogger.info('Server shutting down gracefully')\n\t}\n})\n"],
  "mappings": "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",
  "names": []
}
