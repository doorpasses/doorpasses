---
import MarketingLayout from '../layouts/MarketingLayout.astro'
import { cmsClient } from '../lib/cms'
import RenderHero from '../components/RenderHero.astro'
import RenderBlocks from '../components/RenderBlocks.astro'

const { title, hero, layout, meta } = Astro.props


export async function getStaticPaths() {
  const pages = await cmsClient.getPages()
  
  return pages
    .map((page) => {
      return {
        params: { slug: page.slug },
        props: { 
          title: page.title,
          hero: page.hero,
          layout: page.layout,
          meta: page.meta,
          updatedAt: page.updatedAt,
          createdAt: page.createdAt
        },
      }
    })
}


---

<MarketingLayout>
  {/* SEO Meta Tags */}
  <Fragment slot="head">
    <title>{meta?.title || title || 'Page'}</title>
    {meta?.description && <meta name="description" content={meta.description} />}
    {meta?.image && typeof meta.image === 'object' && meta.image.url && (
      <>
        <meta property="og:image" content={meta.image.url} />
        <meta name="twitter:image" content={meta.image.url} />
      </>
    )}
  </Fragment>

  <article class="min-h-screen">
    {/* Render Hero Section */}
    {hero && <RenderHero {...hero} />}
    
    {/* Render Layout Blocks */}
    {layout && layout.length > 0 && (
      <RenderBlocks blocks={layout} />
    )}
    
    {/* If no layout blocks, show a basic content structure */}
    {(!layout || layout.length === 0) && (
      <section class="py-24">
        <div class="container mx-auto px-4 max-w-4xl">
          <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">{title}</h1>
          <div class="prose prose-lg max-w-none">
            <p>This page has no content blocks configured.</p>
          </div>
        </div>
      </section>
    )}
  </article>
</MarketingLayout>