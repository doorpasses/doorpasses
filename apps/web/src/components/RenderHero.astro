---
import GridDesign from './GridDesign.astro'
import Badge from './ui/Badge.astro'

const CMS_URL = (import.meta as any).env?.PUBLIC_CMS_URL

interface Props {
	type?: string
	richText?: any
	media?: any
	links?: any[]
	videoUrl?: string
	isClosedBeta?: boolean
}

const { type, richText, media, links, videoUrl, isClosedBeta } = Astro.props

// Simple content renderer for Lexical content similar to posts
const renderLexicalContent = (content: any) => {
	if (!content || !content.root || !content.root.children) {
		return ''
	}

	return content.root.children
		.map((node: any) => {
			if (node.type === 'paragraph' && node.children) {
				const text = node.children
					.map((child: any) => child.text || '')
					.join('')
				return `<p class="text-lg">${text}</p>`
			}
			if (node.type === 'heading' && node.children) {
				const text = node.children
					.map((child: any) => child.text || '')
					.join('')
				return `<h1 class="text-6xl tracking-tight">${text}</h1>`
			}
			return ''
		})
		.join('')
}
---

<section class="relative w-full py-12 md:py-12">
	<!-- Grid Design Background -->
	<GridDesign />

	<div class="container relative px-4 md:px-10">
		<div class="lg:flex lg:gap-8">
			<div class="mx-auto max-w-2xl lg:mx-0 lg:shrink-0 md:pt-8">
				<div class="space-y-2">
					<Badge variant="outline" size="sm">
						// BY THE MAKERS OF BUGBASHES.DEV
					</Badge>
					{
						richText && (
							<div
								class="space-y-4"
								set:html={renderLexicalContent(richText)}
							/>
						)
					}
				</div>

				<div
					class="mt-8 relative before:absolute before:top-0 before:h-px before:w-[200vw] before:bg-gray-950/5 dark:before:bg-white/10 before:-left-[100vw] after:absolute after:bottom-0 after:h-px after:w-[200vw] after:bg-gray-950/5 dark:after:bg-white/10 after:-left-[100vw]"
				>
					{
						!isClosedBeta && (
							<>
								{links && links.length > 0 && (
									<>
										<a
											href={links[0]?.url || '#'}
											class="inline-flex items-center justify-center bg-primary text-primary-foreground font-medium text-base py-3 px-6 transition-colors hover:bg-primary/90 rounded-full"
										>
											{links[0]?.link?.label || 'Get started'}
										</a>
										{links[1] && (
											<a
												href={links[1]?.url || '#'}
												class="inline-flex items-center justify-center border border-input bg-background text-foreground font-medium text-base py-3 px-6 transition-colors hover:bg-accent hover:text-accent-foreground rounded-full"
											>
												{links[1]?.link?.label || 'Learn more'}
											</a>
										)}
									</>
								)}
							</>
						)
					}
				</div>
			</div>

			{
				media && (
					<div class="mx-auto mt-16 flex max-w-xl sm:mt-24 lg:mt-0 lg:mr-0 lg:ml-8 lg:max-w-none lg:flex-none xl:ml-16">
						<div class="max-w-2xl flex-none sm:max-w-3xl lg:max-w-none">
							<div class="-m-2 bg-white/2.5 p-2 ring-1 ring-white/10 ring-inset lg:-m-4 lg:p-4">
								<img
									src={`${CMS_URL}${media.url}`}
									alt={media.alt || 'Hero image'}
									width={media.width || 2432}
									height={media.height || 1442}
									class="w-full max-h-[35rem] object-cover bg-white/5 shadow-xl ring-1 ring-white/10"
								/>
							</div>
						</div>
					</div>
				)
			}
		</div>
	</div>
</section>
