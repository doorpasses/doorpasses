---
import GridDesign from '../GridDesign.astro'
import Badge from '../ui/Badge.astro'
import Button from '../ui/Button.astro'
import { cmsClient } from '../../lib/cms'
const CMS_URL = (import.meta as any).env?.PUBLIC_CMS_URL

interface Post {
	id: string
	title: string
	slug: string
	meta?: {
		description?: string
		image?: {
			url: string
			alt?: string
		}
	}
	heroImage: {
		sizes: {
			[key: string]: {
				url: string
			}
		}
	}
}

interface Props {
	title?: string
	subtitle?: string
	description?: string
	posts?: Post[]
	showViewAll?: boolean
	viewAllUrl?: string
	blockType: 'blog'
}

// Fetch recent blog posts using cmsClient
const recentPostsData = await cmsClient.getPosts(1, 3)
const recentPosts = recentPostsData

const {
	title = 'From our blog',
	subtitle = 'Latest insights',
	description = 'Stay updated with our latest insights, tutorials, and product updates',
	posts = recentPosts.docs,
	showViewAll = true,
	viewAllUrl = '/blog',
} = Astro.props
---

<section class="relative w-full py-16 md:py-24">
	<GridDesign />
	<div class="container relative mx-auto px-4 md:px-6">
		<div class="text-center mb-12">
			<Badge variant="outline" size="sm">
				// {subtitle.toUpperCase()}
			</Badge>
			<h2 class="text-4xl md:text-6xl my-4 font-title">
				{title}
			</h2>
			<p class="text-xl text-muted-foreground max-w-[600px] mx-auto">
				{description}
			</p>
		</div>

		{
			posts.length > 0 && (
				<div class="grid grid-cols-1 md:grid-cols-3 px-[1px]">
					{posts.map((post) => (
						<article class="group bg-muted dark:bg-background transition-all duration-200 hover:shadow-lg">
							<div class="bg-card ring-border ring-1 shadow-sm overflow-hidden flex flex-col h-full">
								{post.meta?.image && (
									<div class="aspect-video overflow-hidden border-b border-border/50">
										<img
											src={`${CMS_URL}${post.heroImage.sizes.thumbnail.url}`}
											alt={post.meta.image.alt || post.title}
											class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
										/>
									</div>
								)}
								{/* Card Header */}
								<header class="px-6 py-4">
									<h3 class="text-base font-medium text-card-foreground">
										<a
											href={`/blog/${post.slug}`}
											class="hover:text-primary transition-colors font-title"
											set:html={post.title}
										/>
									</h3>
								</header>
								{/* Card Body */}
								<div class="px-6 pb-4 flex-1 flex flex-col">
									{post.meta?.description && (
										<p
											class="text-muted-foreground text-sm leading-relaxed flex-1"
											set:html={post.meta.description}
										/>
									)}
								</div>
								{/* Card Footer */}
								<footer class="px-5 py-3 pb-4 border-t border-border/50">
									<a
										href={`/blog/${post.slug}`}
										class="inline-flex items-center text-sm font-medium text-primary hover:text-primary/80 transition-colors group/link"
									>
										Read more
										<svg
											class="ml-1 w-4 h-4 transition-transform group-hover/link:translate-x-1"
											fill="none"
											stroke="currentColor"
											viewBox="0 0 24 24"
											xmlns="http://www.w3.org/2000/svg"
										>
											<path
												stroke-linecap="round"
												stroke-linejoin="round"
												stroke-width="2"
												d="M17 8l4 4m0 0l-4 4m4-4H3"
											/>
										</svg>
									</a>
								</footer>
							</div>
						</article>
					))}
				</div>
			)
		}

		{
			showViewAll && (
				<div class="text-center mt-12">
					<Button href={viewAllUrl} variant="link" size="lg">
						View all posts
						<svg
							class="ml-2 w-4 h-4"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
							xmlns="http://www.w3.org/2000/svg"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M17 8l4 4m0 0l-4 4m4-4H3"
							/>
						</svg>
					</Button>
				</div>
			)
		}
	</div>
</section>
