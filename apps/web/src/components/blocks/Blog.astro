---
import GridDesign from '../GridDesign.astro'
import Badge from '../ui/Badge.astro'
import { cmsClient } from '../../lib/cms'
const CMS_URL = (import.meta as any).env?.PUBLIC_CMS_URL

interface Post {
	id: string
	title: string
	slug: string
	meta?: {
		description?: string
		image?: {
			url: string
			alt?: string
		}
	}
}

interface Props {
	title?: string
	subtitle?: string
	description?: string
	posts?: Post[]
	showViewAll?: boolean
	viewAllUrl?: string
	blockType: 'blog'
}

// Fetch recent blog posts using cmsClient
const recentPostsData = await cmsClient.getPosts(1, 3)
const recentPosts = recentPostsData

const {
	title = 'From our blog',
	subtitle = 'Latest insights',
	description = 'Stay updated with our latest insights, tutorials, and product updates',
	posts = recentPosts.docs,
	showViewAll = true,
	viewAllUrl = '/blog',
} = Astro.props
---

<section class="relative w-full py-16 md:py-24">
	<GridDesign />
	<div class="container relative mx-auto px-4 md:px-6">
		<div class="text-center mb-12">
			<Badge variant="outline" size="sm">
				// {subtitle.toUpperCase()}
			</Badge>
			<h2 class="text-4xl md:text-6xl text-primary my-4">
				{title}
			</h2>
			<p class="text-xl text-muted-foreground max-w-[600px] mx-auto">
				{description}
			</p>
		</div>

		{
			posts.length > 0 && (
				<div class="grid grid-cols-1 md:grid-cols-3 border-l border-t border-dashed gap-0">
					{posts.map((post) => (
						<article class="border-b border-r border-dashed bg-background hover:bg-gradient-to-b from-muted/5 to-muted/50 transition-colors">
							{post.meta?.image && (
								<div class="aspect-video overflow-hidden border-b border-dashed">
									<img
										src={`${CMS_URL}${post.meta.image.url}`}
										alt={post.meta.image.alt || post.title}
										class="w-full h-full object-cover"
									/>
								</div>
							)}
							<div class="py-4 space-y-4">
								<h3 class="text-lg font-semibold text-primary border-l-2 border-primary pl-4">
									<a
										href={`/blog/${post.slug}`}
										class="hover:text-primary/80 transition-colors"
										set:html={post.title}
									/>
								</h3>
								{post.meta?.description && (
									<p
										class="text-muted-foreground text-sm leading-relaxed pl-4"
										set:html={post.meta.description}
									/>
								)}
								<a
									href={`/blog/${post.slug}`}
									class="inline-flex items-center text-sm font-medium text-primary hover:text-primary/80 border-b-2 border-transparent hover:border-primary/80 transition-colors pl-4"
								>
									Read more
									<svg
										class="ml-1 w-4 h-4"
										fill="none"
										stroke="currentColor"
										viewBox="0 0 24 24"
										xmlns="http://www.w3.org/2000/svg"
									>
										<path
											stroke-linecap="round"
											stroke-linejoin="round"
											stroke-width="2"
											d="M17 8l4 4m0 0l-4 4m4-4H3"
										/>
									</svg>
								</a>
							</div>
						</article>
					))}
				</div>
			)
		}

		{
			showViewAll && (
				<div class="text-center mt-12">
					<a
						href={viewAllUrl}
						class="inline-flex items-center text-lg font-medium text-primary hover:text-primary/80 border-b-2 border-transparent hover:border-primary/80 transition-colors"
					>
						View all posts
						<svg
							class="ml-2 w-4 h-4"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
							xmlns="http://www.w3.org/2000/svg"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M17 8l4 4m0 0l-4 4m4-4H3"
							/>
						</svg>
					</a>
				</div>
			)
		}
	</div>
</section>
